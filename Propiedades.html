<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <title>CleanHome Admin</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!----css3---->
    <link rel="stylesheet" href="css/custom.css" />
    <!-- SLIDER REVOLUTION 4.x CSS SETTINGS -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
        rel="stylesheet" />

    <!--google material icon-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />
</head>

<body>
    <div class="wrapper">
        <div class="body-overlay"></div>

        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <img src="img/imagotipo.svg" class="img-fluid" style="width: 70px; height: 70px;"/>
            </div>
            
            <ul class="list-unstyled components">
                <li class="active">
                    <a href="index.html" class="dashboard"><i class="material-icons">cleaning_services</i><span>Home</span></a>
                </li>

                <li class="active">
                    <a href="/Propiedades.html" class="dashboard"><i class="material-icons">home</i><span>Propiedades</span></a>
                </li>

                <li class="active">
                    <a href="/Usuarios.html" class="dashboard"><i class="material-icons">person</i><span>Usuarios</span></a>
                </li>

            </ul>
        </nav>

        <!-- Page Content  -->
        <div id="content">
            <div class="top-navbar">
                <nav class="navbar navbar-expand-lg">
                    <div class="container-fluid">
                        <button type="button" id="sidebarCollapse" class="d-xl-block d-lg-block d-md-mone d-none">
                            <span class="material-icons">arrow_back_ios</span>
                        </button>

                        <a class="navbar-brand" href="#"> CleanHome </a>
                        

                        <button class="d-inline-block d-lg-none ml-auto more-button" type="button"
                            data-toggle="collapse" data-target="#navbarSupportedContent"
                            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="material-icons">more_vert</span>
                        </button>

                        <div class="collapse navbar-collapse d-lg-block d-xl-block d-sm-none d-md-none d-none"
                            id="navbarSupportedContent">
                            <ul class="nav navbar-nav ml-auto">
                                <li class="dropdown nav-item active">
                                    <a href="#" class="nav-link" data-toggle="dropdown">
                                        <span class="material-icons">notifications</span>
                                        <span class="notification">4</span>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="#">You have 5 new msg</a>
                                        </li>
                                        <li>
                                            <a href="#">You're now friend with Mike</a>
                                        </li>
                                        <li>
                                            <a href="#">Wish Mary on her birthday!</a>
                                        </li>
                                        <li>
                                            <a href="#">5 warnings in Server Console</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <span class="material-icons">apps</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <span class="material-icons">person</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <span class="material-icons">settings</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>

            <script>

                                    async function consumirAPIPropiedades(){
                                    const urlgetPropiedades='http://clenhometm.trafficmanager.net:2813/ch/propiedad/getallPropiedades';

                                    fetch(urlgetPropiedades).then(response => {
                                    return response.json();
                                    
                                    }).then(res => {
                                    console.log(res);
                                    mostrarDatosPropiedades(res);
                                    
                                    }).catch(err => {
                                    console.log(err);
                                    });
        
                                    };

                                    function mostrarDatosPropiedades(res) {
    const listPropiedades = document.getElementById('propiedadesList');
    listPropiedades.innerHTML = ''; // Limpiar la lista antes de agregar nuevas propiedades
    
    if (res == null) {
        const tituloNoHay = document.createElement('h2');
        tituloNoHay.textContent = 'Por el momento no hay propiedades registradas.';
        tituloNoHay.className = 'text-danger';
        listPropiedades.appendChild(tituloNoHay);
    } else {
        res.map(propiedad => {
            const idPropiedad = propiedad.id;

            const divCard = document.createElement('div');
            divCard.className = 'col-lg-5 col-md-4 col-sm-6';

            const divPropiedad = document.createElement('div');
            divPropiedad.className = 'card-body';

            const divCarousel = document.createElement('div');
            divCarousel.className = 'carousel slide';
            divCarousel.id = `carousel-${idPropiedad}`;
            divCarousel.setAttribute('data-ride', 'carousel');

            const carouselInner = document.createElement('div');
            carouselInner.className = 'carousel-inner';

            propiedad.foto.forEach((foto, index) => {
                const carouselItem = document.createElement('div');
                carouselItem.className = index === 0 ? 'carousel-item active' : 'carousel-item';

                const img = document.createElement('img');
                img.src = `http://74.208.25.75/images/cleanhome/${foto.foto}`;
                img.alt = 'Imagen de la propiedad';
                img.className = 'd-block w-100';

                carouselItem.appendChild(img);
                carouselInner.appendChild(carouselItem);
            });

            const carouselPrev = document.createElement('a');
            carouselPrev.className = 'carousel-control-prev';
            carouselPrev.href = `#carousel-${idPropiedad}`;
            carouselPrev.role = 'button';
            carouselPrev.setAttribute('data-slide', 'prev');

            const prevIcon = document.createElement('span');
            prevIcon.className = 'carousel-control-prev-icon';
            prevIcon.setAttribute('aria-hidden', 'true');
            carouselPrev.appendChild(prevIcon);

            const carouselNext = document.createElement('a');
            carouselNext.className = 'carousel-control-next';
            carouselNext.href = `#carousel-${idPropiedad}`;
            carouselNext.role = 'button';
            carouselNext.setAttribute('data-slide', 'next');

            const nextIcon = document.createElement('span');
            nextIcon.className = 'carousel-control-next-icon';
            nextIcon.setAttribute('aria-hidden', 'true');
            carouselNext.appendChild(nextIcon);

            carouselPrev.appendChild(prevIcon);
            carouselNext.appendChild(nextIcon);

            divCarousel.appendChild(carouselInner);
            divCarousel.appendChild(carouselPrev);
            divCarousel.appendChild(carouselNext);

            const h5Titulo = document.createElement('h3');
            h5Titulo.textContent = propiedad.titulo;

            const pDireccion = document.createElement('p');
            pDireccion.textContent = `Calle: ${propiedad.calle}, #${propiedad.numeroExt}, C.P.: ${propiedad.codigoPostal}, Colonia: ${propiedad.colonia}`;

            const pReferencias = document.createElement('p');
            pReferencias.textContent = `Referencia: ${propiedad.referencias}`;

            const pEstatus = document.createElement('p');
            pEstatus.textContent = `Estatus: ${propiedad.estatus}`;

            const pTipo = document.createElement('p');
            pTipo.textContent = `Tipo propiedad: ${propiedad.tipoPropiedad.tipo}`;

            const pEstado = document.createElement('p');
            pEstado.textContent = `Estado: ${propiedad.estado.estado}`;

            const aceptarButton = document.createElement('button');
            aceptarButton.id = 'btnEditar';
            aceptarButton.textContent = 'Aceptar';
            aceptarButton.className = 'btn btn-success btn-lg btn-block';
            aceptarButton.addEventListener('click', () => aceptarPropiedad(idPropiedad));

            const rechazarButton = document.createElement('button');
            rechazarButton.textContent = 'Rechazar';
            rechazarButton.className = 'btn btn-danger btn-lg btn-block';
            rechazarButton.addEventListener('click', () => rechazarPropiedad(idPropiedad));

            const divPropiedadFooter = document.createElement('div');
            divPropiedadFooter.className = 'card-footer';
            divPropiedadFooter.appendChild(aceptarButton);
            divPropiedadFooter.appendChild(rechazarButton);

            divCard.appendChild(divPropiedad);
            divCard.appendChild(divCarousel);
            divPropiedad.appendChild(h5Titulo);
            divPropiedad.appendChild(pDireccion);
            divPropiedad.appendChild(pReferencias);
            divPropiedad.appendChild(pEstatus);
            divPropiedad.appendChild(pTipo);
            divPropiedad.appendChild(pEstado);
            divPropiedad.appendChild(divPropiedadFooter);

            listPropiedades.appendChild(divCard);
        });
    }
}



                                    async function aceptarPropiedad(idPropiedad){
                                            const urlupdatePropiedasEstatus = `http://clenhometm.trafficmanager.net:2813/ch/propiedad/editarEstadoPropiedad/${idPropiedad}`;
                                            const dataEstatus={
                                                estatus:'aprobado'
                                            }
                                            try {
                                            const response = await fetch(urlupdatePropiedasEstatus, {
                                                method: 'PUT',
                                                headers: {
                                                    "Access-Control-Allow-Origin": "*",
                                                    "Access-Control-Allow-Headers": "PUT, GET, POST, DELETE, OPTIONS, HEAD, Authorization, Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers, Access-Control-Allow-Origin",
                                                    "Content-Type": "application/json",
                                                },
                                                body: JSON.stringify(dataEstatus)
                                            });

                                            if (response.ok) {
                                                location.reload(); // Actualizar la tabla después de editar el servicio
                                            } else {
                                                console.error('Error al editar la propiedad:', response.status, response.statusText);
                                            }
                                        } catch (error) {
                                            console.error('Error en la solicitud:', error);
                                        }

                                    }

                                    async function rechazarPropiedad(idPropiedad){
                                            const urlupdatePropiedasEstatus = `http://clenhometm.trafficmanager.net:2813/ch/propiedad/editarEstadoPropiedad/${idPropiedad}`;
                                            const dataEstatus={
                                                estatus:'rechazada'
                                            }
                                            try {
                                            const response = await fetch(urlupdatePropiedasEstatus, {
                                                method: 'PUT',
                                                headers: {
                                                    "Access-Control-Allow-Origin": "*",
                                                    "Access-Control-Allow-Headers": "PUT, GET, POST, DELETE, OPTIONS, HEAD, Authorization, Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers, Access-Control-Allow-Origin",
                                                    "Content-Type": "application/json",
                                                },
                                                body: JSON.stringify(dataEstatus)
                                            });

                                            if (response.ok) {
                                                location.reload(); // Actualizar la tabla después de editar el servicio
                                            } else {
                                                console.error('Error al editar la propiedad:', response.status, response.statusText);
                                            }
                                        } catch (error) {
                                            console.error('Error en la solicitud:', error);
                                        }

                                    }
                            consumirAPIPropiedades();

            </script>

            <div class="main-content">
                <h2>Propiedades Disponibles</h2>
                <div id="propiedadesList" style="grid-template-columns: repeat(auto-fill,240px)" class="row">
                
                </div>
                
                <div class="row">
                    
                    
                    
                
                </div>
            </div>

                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6">
                                <nav class="d-flex">
                                    <ul class="m-0 p-0">
                                        <li>
                                            <a href="#"> Home </a>
                                        </li>
                                        <li>
                                            <a href="#"> Company </a>
                                        </li>
                                        <li>
                                            <a href="#"> Portfolio </a>
                                        </li>
                                        <li>
                                            <a href="#"> Blog </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="col-md-6">
                                <p class="copyright d-flex justify-content-end">
                                    &copy 2023 Design by
                                    <a href="https://front-end-designer.netlify.app/">Front-End-Designer
                                </p>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#sidebarCollapse").on("click", function () {
                $("#sidebar").toggleClass("active");
                $("#content").toggleClass("active");
            });

            $(".more-button,.body-overlay").on("click", function () {
                $("#sidebar,.body-overlay").toggleClass("show-nav");
            });
        });
    </script>
</body>

</html>